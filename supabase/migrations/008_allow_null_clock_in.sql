Kiro
なるほど！個人Gmailアカウントはスタッフではないので、システムにログインできないということですね。

この問題を解決するために、2つのアカウントを使い分ける必要があります：

解決策：アカウントの使い分け
1. システムへのログイン
組織アカウント（tomoko.kunihiro@ifoo-oita.com）でログイン
これでシステムにアクセスできます
2. Google API連携
ログイン後、「Googleカレンダーと連携」ボタンをクリック
個人Gmailアカウント（@gmail.com）を選択して連携
これでGoogle APIのアクセストークンが取得できます
重要なポイント
現在のコードでは、ログインユーザーのアカウントとGoogle連携するアカウントが同じである必要があります。これが問題の原因です。

修正が必要な箇所
スタッフ管理画面（/staff）へのアクセスを、管理者のみに制限し、管理者が個人Gmailアカウントで連携したトークンを使ってスプレッドシートにアクセスできるようにする必要があります。

現在のコードを確認して、修正方法を提案します。

Read file(s)

page.tsx

route.ts
問題が分かりました！現在のコードは、ログインしているユーザー自身のGoogleトークンを使ってスプレッドシートにアクセスしようとしています。

つまり：

tomoko.kunihiro@ifoo-oita.comでログイン
そのアカウントのGoogleトークンを使ってスプレッドシートにアクセス
でも、@ifoo-oita.comアカウントではGoogle APIが使えない
解決策
管理者専用のGoogleトークンを別途保存する仕組みが必要です。以下の2つの方法があります：

方法1：環境変数にサービスアカウントキーを保存（推奨）
個人Gmailアカウントでサービスアカウントを作成し、そのキーを使う

方法2：特定の管理者アカウントのトークンを使う
個人Gmailアカウントを「システム管理者」として登録し、そのトークンを全管理者が共有

今回は方法2の方がシンプルなので、こちらで実装します。

実装内容
staffsテーブルに「システム管理者」として個人Gmailアカウントを登録
スタッフ同期APIで、ログインユーザーではなく「システム管理者」のトークンを使用
実装しますか？